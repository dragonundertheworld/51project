A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\.obj
ASSEMBLER INVOKED BY: D:\KEIL\C51\BIN\A51.EXE .a51 SET(SMALL) DEBUG PRINT(.\Listings\.lst) OBJECT(.\Objects\
                      .obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ;主机初始化串口
0000                   2     S_INIT: 
  REG                  3     TEMP EQU R1
0000 7598D0            4     MOV SCON, #0D0H
0003 758920            5     MOV TMOD, #20H
0006 758DFD            6     MOV TH1,#0FDH
0009 758BFD            7     MOV TL1,#0FDH
000C D28E              8     SETB TR1
                       9     
                      10     ;主程序，在数码管上显示数据
000E                  11     START:
000E D290             12     SETB P1.0
0010 C291             13     CLR P1.1
0012 75A0FE           14     MOV P2,#11111110B;??
0015 D291             15     SETB P1.1
0017 C290             16     CLR P1.0
0019 8529A0           17     MOV P2,29H
001C 120198           18     LCALL DELAY
001F D290             19     SETB P1.0
0021 C291             20     CLR P1.1
0023 75A0FD           21     MOV P2,#11111101B;??
0026 D291             22     SETB P1.1
0028 C290             23     CLR P1.0
002A 8528A0           24     MOV P2,28H
002D 120198           25     LCALL DELAY
0030 D290             26     SETB P1.0
0032 C291             27     CLR P1.1
0034 75A0FB           28     MOV P2,#11111011B;??
0037 D291             29     SETB P1.1
0039 C290             30     CLR P1.0
003B 8526A0           31     MOV P2,26H
003E D2A7             32     SETB P2.7
0040 120198           33     LCALL DELAY
0043 D290             34     SETB P1.0
0045 C291             35     CLR P1.1
0047 75A0F7           36     MOV P2,#11110111B;??
004A D291             37     SETB P1.1
004C C290             38     CLR P1.0
004E 8527A0           39     MOV P2,27H
0051 120198           40     LCALL DELAY
                      41     
0054 D290             42     SETB P1.0
0056 C291             43     CLR P1.1
0058 75A0EF           44     MOV P2,#11101111B;??
005B D291             45     SETB P1.1
005D C290             46     CLR P1.0
005F 8532A0           47     MOV P2,32H
0062 120198           48     LCALL DELAY
0065 D290             49     SETB P1.0
0067 C291             50     CLR P1.1
0069 75A0DF           51     MOV P2,#11011111B;??
006C D291             52     SETB P1.1
006E C290             53     CLR P1.0
0070 8530A0           54     MOV P2,30H
0073 120198           55     LCALL DELAY
0076 D290             56     SETB P1.0
0078 C291             57     CLR P1.1
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     2

007A 75A0BF           58     MOV P2,#10111111B;??
007D D291             59     SETB P1.1
007F C290             60     CLR P1.0
0081 8533A0           61     MOV P2,33H
0084 D2A7             62     SETB P2.7
0086 120198           63     LCALL DELAY
0089 D290             64     SETB P1.0
008B C291             65     CLR P1.1
008D 75A07F           66     MOV P2,#01111111B;??
0090 D291             67     SETB P1.1
0092 C290             68     CLR P1.0
0094 8531A0           69     MOV P2,31H
0097 120198           70     LCALL DELAY
009A 209806           71     JB RI,COMMU
009D 02000E           72     LJMP START
                      73     
                      74     ;过渡程序->跳转到发送地址程序段
00A0                  75     TRANS:
00A0 0200A5           76     LJMP SEND_ADDR1
                      77     
                      78     ;主从之间开始传输
00A3                  79     COMMU:
00A3 C298             80     CLR RI
                      81     
                      82     ;主机发送从机1地址：准备和从机1握手
00A5                  83     SEND_ADDR1:
00A5 D29B             84     SETB TB8
                      85     ;??IB8,???????????
00A7 7401             86     MOV A,#1
00A9 F599             87     MOV SBUF,A ;??????
00AB 3099FD           88     JNB TI, $
                      89     ;????????????
00AE C299             90     CLR TI
                      91     
                      92     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
00B0                  93     CHECK1:
00B0 3098FD           94     JNB RI, $;
00B3 C298             95     CLR RI
00B5 E599             96     MOV A, SBUF
00B7 B40102           97     CJNE A, #1, T
00BA 8003             98     JMP RECEIVE1
00BC 020118           99     T:LJMP TRANS1
                     100     ;?????????
                     101     
                     102     ;主机接收数据并进行奇偶校验，该数据是温度数据的整数部分
00BF                 103     RECEIVE1:
00BF 3098FD          104     JNB RI,$
00C2 C298            105     CLR RI
00C4 E599            106     MOV A, SBUF
00C6 A2D0            107     MOV C,P;????????C
00C8 5051            108     JNC TRANS2;?c=0,?????,??????
00CA C2E7            109     CLR ACC.7
                     110     ;??A??????????
00CC F528            111     MOV 28H,A 
                     112     
                     113     ;主机发送从机1地址：准备和从机1第二次握手
00CE                 114     SEND_ADDR2:
00CE D29B            115     SETB TB8
                     116     ;??IB8,???????????
00D0 7401            117     MOV A,#1
00D2 F599            118     MOV SBUF, A ;??????
00D4 3099FD          119     JNB TI, $
                     120     ;????????????
00D7 C299            121     CLR TI
                     122     
                     123     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     3

00D9                 124     CHECK2:
00D9 3098FD          125     JNB RI, $;
00DC C298            126     CLR RI
00DE E599            127     MOV A, SBUF
00E0 B40135          128     CJNE A, #1, TRANS1
                     129     ;?????????
                     130     
                     131     ;主机接收数据并进行奇偶校验，该数据是温度数据的小数部分
00E3                 132     RECEIVE2:
00E3 3098FD          133     JNB RI,$
00E6 C298            134     CLR RI
00E8 E599            135     MOV A, SBUF
00EA A2D0            136     MOV C,P;????????C
00EC 502D            137     JNC TRANS2;?c=0,?????,??????
00EE C2E7            138     CLR ACC.7
                     139     ;??A??????????
00F0 F527            140     MOV 27H,A 
                     141     
                     142     ;主机发送从机1地址：准备和从机1第三次握手
00F2                 143     SEND_ADDR3:
00F2 D29B            144     SETB TB8
                     145     ;??IB8,???????????
00F4 7401            146     MOV A,#1
00F6 F599            147     MOV SBUF, A ;??????
00F8 3099FD          148     JNB TI, $
                     149     ;????????????
00FB C299            150     CLR TI
                     151     
                     152     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
00FD                 153     CHECK3:
00FD 3098FD          154     JNB RI, $;
0100 C298            155     CLR RI
0102 E599            156     MOV A, SBUF
0104 B40111          157     CJNE A, #1, TRANS1
                     158     ;?????????
                     159     
                     160     ;主机接收数据并进行奇偶校验，该数据是温度数据的符号部分
0107                 161     RECEIVE3:
0107 3098FD          162     JNB RI,$
010A C298            163     CLR RI
010C E599            164     MOV A, SBUF
010E A2D0            165     MOV C,P;????????C
0110 5009            166     JNC TRANS2;?c=0,?????,??????
0112 C2E7            167     CLR ACC.7
                     168     ;??A??????????
0114 F529            169     MOV 29H,A 
0116 211E            170     AJMP SEND_ADDR1_0
                     171     ;LJMP START
                     172     ;?SM2???
                     173     
                     174     ;由于JNC，CJNE等语句跳转范围有限，需要过渡程序
0118 0201CB          175     TRANS1:LJMP FAIL
011B 0201D0          176     TRANS2:LJMP ERROR
                     177     
                     178     ;主机发送从机2地址：准备和从机2第一次握手
011E                 179     SEND_ADDR1_0:
011E D29B            180     SETB TB8
                     181     ;??IB8,???????????
0120 7400            182     MOV A,#0
0122 F599            183     MOV SBUF,A ;??????
0124 3099FD          184     JNB TI, $
                     185     ;????????????
0127 C299            186     CLR TI
                     187     
                     188     
                     189     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     4

0129                 190     CHECK1_0:
0129 3098FD          191     JNB RI, $;
012C C298            192     CLR RI
012E E599            193     MOV A, SBUF
0130 B40089          194     CJNE A, #0, T
0133 8003            195     JMP RECEIVE1_0
0135 0201A1          196     LJMP TRANS1_0
                     197     ;?????????
                     198     
                     199     ;主机接收数据并进行奇偶校验，该数据是温度数据的小数部分
0138                 200     RECEIVE1_0:
0138 3098FD          201     JNB RI,$
013B C298            202     CLR RI
013D E599            203     MOV A, SBUF
013F A2D0            204     MOV C,P;????????C
0141 5061            205     JNC TRANS2_0;?c=0,?????,??????
0143 C2E7            206     CLR ACC.7
                     207     ;??A??????????
0145 F530            208     MOV 30H,A 
                     209     
                     210     ;主机发送从机2地址：准备和从机2第二次握手
0147                 211     SEND_ADDR2_0:
0147 D29B            212     SETB TB8
                     213     ;??IB8,???????????
0149 7400            214     MOV A,#0
014B F599            215     MOV SBUF, A ;??????
014D 3099FD          216     JNB TI, $
                     217     ;????????????
0150 C299            218     CLR TI
                     219     
                     220     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
0152                 221     CHECK2_0:
0152 3098FD          222     JNB RI, $;
0155 C298            223     CLR RI
0157 E599            224     MOV A, SBUF
0159 B40045          225     CJNE A, #0, TRANS1_0
                     226     ;?????????
                     227     
                     228     ;主机接收数据并进行奇偶校验，该数据是温度数据的整数部分
015C                 229     RECEIVE2_0:
015C 3098FD          230     JNB RI,$
015F C298            231     CLR RI
0161 E599            232     MOV A, SBUF
0163 A2D0            233     MOV C,P;????????C
0165 503D            234     JNC TRANS2_0;?c=0,?????,??????
0167 C2E7            235     CLR ACC.7
                     236     ;??A??????????
0169 F531            237     MOV 31H,A 
                     238     
                     239     ;主机发送从机2地址：准备和从机2第三次握手
016B                 240     SEND_ADDR3_0:
016B D29B            241     SETB TB8
                     242     ;??IB8,???????????
016D 7400            243     MOV A,#0
016F F599            244     MOV SBUF, A ;??????
0171 3099FD          245     JNB TI, $
                     246     ;????????????
0174 C299            247     CLR TI
                     248     
                     249     ;检测从机的应答信号：若应答不正确则返回上一步；正确则继续
0176                 250     CHECK3_0:
0176 3098FD          251     JNB RI, $;
0179 C298            252     CLR RI
017B E599            253     MOV A, SBUF
017D B40021          254     CJNE A, #0, TRANS1_0
                     255     
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     5

                     256     ;主机接收数据并进行奇偶校验，该数据是温度数据的符号部分
0180                 257     RECEIVE3_0:
0180 3098FD          258     JNB RI,$
0183 C298            259     CLR RI
0185 E599            260     MOV A, SBUF
0187 A2D0            261     MOV C,P;????????C
0189 5019            262     JNC TRANS2_0;?c=0,?????,??????
018B C2E7            263     CLR ACC.7
018D F532            264     MOV 32H,A
                     265     
                     266     ;调用SEP12
018F 1201A7          267     LCALL SEP1
0192 1201B9          268     LCALL SEP2
                     269     
0195 02000E          270     LJMP START
                     271     ;?SM2???
                     272     
0198                 273     DELAY:
0198 7864            274     MOV R0,#100
019A                 275     LOOP:
019A 790A            276     MOV R1,#10
019C D9FE            277     DJNZ R1,$
019E D8FA            278     DJNZ R0,LOOP
01A0 22              279     RET
                     280     
                     281     ;由于JNC，CJNE等语句跳转范围有限，需要过渡程序
01A1 0201CB          282     TRANS1_0:LJMP FAIL
01A4 0201D0          283     TRANS2_0:LJMP ERROR
                     284     
                     285     ;采用查表方式进行数码管显示
01A7                 286     SEP1:
01A7 E528            287     MOV A,28H
01A9 75F00A          288     MOV B,#0AH
01AC 84              289     DIV AB
01AD 901000          290     MOV DPTR,#1000H
01B0 93              291     MOVC A,@A+DPTR
01B1 F528            292     MOV 28H,A
01B3 E5F0            293     MOV A,B
01B5 93              294     MOVC A,@A+DPTR
01B6 F526            295     MOV 26H,A
01B8 22              296     RET
                     297     
01B9                 298     SEP2:
01B9 E530            299     MOV A,30H
01BB 75F00A          300     MOV B,#0AH
01BE 84              301     DIV AB
01BF 901000          302     MOV DPTR,#1000H
01C2 93              303     MOVC A,@A+DPTR
01C3 F530            304     MOV 30H,A
01C5 E5F0            305     MOV A,B
01C7 93              306     MOVC A,@A+DPTR
01C8 F533            307     MOV 33H,A
01CA 22              308     RET
                     309     
                     310     ;出错时跳转进下面两个函数之一
01CB                 311     FAIL:
01CB 75A00F          312     MOV P2,#00001111B
01CE 21CB            313     AJMP FAIL
01D0                 314     ERROR: 
01D0 7590F0          315     MOV P1,#11110000B
01D3 21D3            316     AJMP $
01D5 C29D            317     CLR SM2
                     318     
                     319     ;表格
1000                 320     ORG 1000H
1000                 321     TAB:
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     6

1000 3F065B4F        322     DB 03FH,06H,5BH,4FH,66H,6DH,7DH,07H,07FH,6FH
1004 666D7D07                
1008 7F6F                    
                     323     END
A51 MACRO ASSEMBLER  ____                                                                 05/16/2022 22:14:50 PAGE     7

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . .  D ADDR   00E0H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
CHECK1 . . . . . .  C ADDR   00B0H   A   
CHECK1_0 . . . . .  C ADDR   0129H   A   
CHECK2 . . . . . .  C ADDR   00D9H   A   
CHECK2_0 . . . . .  C ADDR   0152H   A   
CHECK3 . . . . . .  C ADDR   00FDH   A   
CHECK3_0 . . . . .  C ADDR   0176H   A   
COMMU. . . . . . .  C ADDR   00A3H   A   
DELAY. . . . . . .  C ADDR   0198H   A   
ERROR. . . . . . .  C ADDR   01D0H   A   
FAIL . . . . . . .  C ADDR   01CBH   A   
LOOP . . . . . . .  C ADDR   019AH   A   
P. . . . . . . . .  B ADDR   00D0H.0 A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
RECEIVE1 . . . . .  C ADDR   00BFH   A   
RECEIVE1_0 . . . .  C ADDR   0138H   A   
RECEIVE2 . . . . .  C ADDR   00E3H   A   
RECEIVE2_0 . . . .  C ADDR   015CH   A   
RECEIVE3 . . . . .  C ADDR   0107H   A   
RECEIVE3_0 . . . .  C ADDR   0180H   A   
RI . . . . . . . .  B ADDR   0098H.0 A   
SBUF . . . . . . .  D ADDR   0099H   A   
SCON . . . . . . .  D ADDR   0098H   A   
SEND_ADDR1 . . . .  C ADDR   00A5H   A   
SEND_ADDR1_0 . . .  C ADDR   011EH   A   
SEND_ADDR2 . . . .  C ADDR   00CEH   A   
SEND_ADDR2_0 . . .  C ADDR   0147H   A   
SEND_ADDR3 . . . .  C ADDR   00F2H   A   
SEND_ADDR3_0 . . .  C ADDR   016BH   A   
SEP1 . . . . . . .  C ADDR   01A7H   A   
SEP2 . . . . . . .  C ADDR   01B9H   A   
SM2. . . . . . . .  B ADDR   0098H.5 A   
START. . . . . . .  C ADDR   000EH   A   
S_INIT . . . . . .  C ADDR   0000H   A   
T. . . . . . . . .  C ADDR   00BCH   A   
TAB. . . . . . . .  C ADDR   1000H   A   
TB8. . . . . . . .  B ADDR   0098H.3 A   
TEMP . . . . . . .    REG    R1          
TH1. . . . . . . .  D ADDR   008DH   A   
TI . . . . . . . .  B ADDR   0098H.1 A   
TL1. . . . . . . .  D ADDR   008BH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR1. . . . . . . .  B ADDR   0088H.6 A   
TRANS. . . . . . .  C ADDR   00A0H   A   
TRANS1 . . . . . .  C ADDR   0118H   A   
TRANS1_0 . . . . .  C ADDR   01A1H   A   
TRANS2 . . . . . .  C ADDR   011BH   A   
TRANS2_0 . . . . .  C ADDR   01A4H   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
